{% extends 'dashboard/layout.html' %}
{% load i18n %}
{% load thumbnail %}
{% load staticfiles %}
{% load form_tags %}

{% block body_class %}{{ block.super }} create-page catalogue{% endblock %}

{% block title %}
    {{ title }} | {% trans "Products" %} | {{ block.super }}
{% endblock %}

{% block breadcrumbs %}
    <ul class="breadcrumb">
        <li>
            <a href="{% url 'dashboard:index' %}">{% trans "Dashboard" %}</a>
        </li>
        <li>
            <a href="{% url 'dashboard:catalogue-product-list' %}">{% trans "Products" %}</a>
        </li>
        {% if parent %}
            <li>
                <a href="{% url 'dashboard:catalogue-product' parent.id %}">
                    {{ parent.title }}
                </a>
            </li>
        {% endif %}
        <li class="active">{{ title }}</li>
    </ul>
{% endblock %}

{% block headertext %}{{ title }}{% endblock %}

{% block dashboard_content %}

    <style>
        {% if isVendor %}
            .partner_class{
                display: none !important;
            }
        {% endif %}
        .seq-class{
            margin-top: -15px;
            margin-bottom: 5px;
        }
    </style>

    <form action="{% if request.GET.urlencode %}?{{ request.GET.urlencode }}{% endif %}" method="post" class="form-stacked wysiwyg fixed-actions {% if request.user.is_superuser %} admin_form {% else %} vendor_form {% endif %}" enctype="multipart/form-data" data-behaviour="affix-nav-errors" autocomplete="off">
        {% csrf_token %}

        {% if parent %}
            <div class="row">
                <div class="col-md-12">
                    <div class="alert alert-info">
                        {% url 'dashboard:catalogue-product' pk=parent.id as parent_url %}
                        {% blocktrans with title=parent.title %}
                            You are currently editing a product variant of
                            <a href="{{ parent_url }}">{{ title }}</a>.
                        {% endblocktrans %}
                    </div>
                </div>
            </div>
        {% endif %}

        <div class="row">

            {% block tab_nav %}
                <div class="col-md-3">
                    <div data-spy="affix" class="affix-top" data-offset-top="200">
                        <div class="table-header">
                            <h3>{% trans "Sections" %}</h3>
                        </div>
                        <ul class="nav nav-list bs-docs-sidenav" id="product_update_tabs">
                            {% comment %}
                                The navigation below is filtered heavily on the product structure.
                                This intentionally is the only place where filtering is done, as
                                deployments are likely to want to override certain aspects of what
                                data is stored on products of a certain structure. This means that
                                only one template block (instead of all affected) has to be altered.
                            {% endcomment %}
                            {% block tabs %}
                                <li class="active">
                                    <a href="#product_details" data-toggle="tab">
                                        {% trans 'Product details' %}
                                    </a>
                                </li>
                                {% if not parent %}
                                    <li>
                                        <a href="#product_category" data-toggle="tab">
                                            {% trans 'Categories' %}
                                        </a>
                                    </li>
                                {% endif %}
                                {% if product_class.has_attributes %}
                                    <li>
                                        <a href="#product_attributes" data-toggle="tab">
                                            {% trans 'Attributes' %}
                                        </a>
                                    </li>
                                {% endif %}
                                {% if not product_class.name == 'Service' %}
                                    {% if not product.is_parent %}
                                        <li>
                                            <a href="#product_stock" data-toggle="tab" onclick="product_stock_toggle()">
                                                {% trans 'Stock and pricing' %}
                                            </a>
                                        </li>
                                    {% endif %}
                                {% endif %}
                                <li>
                                    <a href="#product_images" data-toggle="tab">
                                        {% trans 'Images' %} 
                                    </a>
                                </li>
                                <li>
                                    <a href="#attribute" data-toggle="tab">
                                        {% trans 'Attribute' %}
                                    </a>
                                </li>
                                {% if product.product_class.name in 'Rent' %}
                                    {% if product.id %}
                                        <li>
                                            <a href="{% url 'dashboard:create-combo' pk=product.id %}" target="_blank">
                                                {% trans 'Combo Offers (New)' %}
                                            </a>
                                        </li>
                                    {% endif %}
                                {% endif %}

                                <li>
                                    <a href="#product_package" data-toggle="tab" id="product_package_tab">
                                        {% trans 'Product Package' %}
                                    </a>
                                </li>
                            {% endblock tabs %}
                        </ul>
                    </div>
                </div>
            {% endblock tab_nav %}

            <div class="col-md-9">
                <div class="tab-content">
                    {% block tab_content %}

                        <!-- Product details tab (for all product types visible) -->
                         {% block product_details %}
                            <div class="tab-pane active" id="product_details">
                                <div class="table-header">
                                    <h3>{% trans "Product details" %}</h3>
                                </div>
                                <div class="well product-details">
                                    {% block product_details_content %}
                                        {% include "dashboard/catalogue/innerpages/product_details_update.html" %}
                                    {% endblock product_details_content %}
                                </div>
                            </div>
                        {% endblock product_details %}

                        <!-- Product details tab (for all product types visible) -->

                        <!-- Product category tab (for all product types visible) -->
                        {% block product_categories %}
                            <div class="tab-pane" id="product_category">
                                {% block product_categories_content %}
                                    {% include "dashboard/catalogue/innerpages/product_category_update.html" %}
                                {% endblock product_categories_content %}
                            </div>
                        {% endblock product_categories %}
                        <!-- Product category tab (for all product types visible) -->

                        <!-- Product attributes (need to check) -->
                        {% block product_attributes %}
                            <div class="tab-pane" id="product_attributes">
                                {% block product_attributes_content %}
                                    {% include "dashboard/catalogue/innerpages/product_attibutes_update.html" %}
                                {% endblock product_attributes_content %}
                            </div>
                        {% endblock product_attributes %}
                        <!-- Product attributes (need to check) -->

                        <!-- Product images (for all product types visible) -->
                        {% block product_images %}
                            <div class="tab-pane" id="product_images">
                                {% include "dashboard/catalogue/innerpages/product_images_update.html" %}
                            </div>
                        {% endblock product_images %}

<!--                         Product package (for all product types visible) -->
                    {% if product.product_class.name != 'Service' %}
                         <div class="tab-pane" id="product_package">
                                {% include "dashboard/catalogue/innerpages/product_package.html" %}
                            </div>
                    {% endif %}


                        <!-- Product images (for all product types visible) -->
                         <div class="tab-pane" id="attribute">
                                {% include "dashboard/catalogue/innerpages/attribute_product.html" %}
                            </div>



                        <!-- Product stockrecord ()-->
                        {% block stockrecords %}
                            <div class="tab-pane" id="product_stock">
                                {% block stockrecords_content %}
                                    {% include "dashboard/catalogue/innerpages/product_stockrecord_update.html" %}
                                {% endblock stockrecords_content %}
                            </div>
                        {% endblock stockrecords %}
                        <!-- Product stockrecord ()-->

                        {% block child_products %}
                            {% with children=product.children.all %}
                                <div class="tab-pane" id="child_products">
                                    {% block child_products_content %}
                                        <table class='table table-striped table-bordered'>
                                            <caption>
                                                {% trans "Variants" %}
                                                <button class="btn btn-primary pull-right{% if not product.can_be_parent %} disabled{% endif %}" name="action" type="submit" value="create-child" data-loading-text="{% trans 'Adding...' %}">
                                                    <em class="icon-plus"></em>
                                                    {% trans "Add variant" %}
                                                </button>
                                            </caption>
                                            {% if children %}
                                                <tr>
                                                    <th>{% trans "Title" %}</th>
                                                    <th>{% trans "Attributes" %}</th>
                                                    <th>{% trans "Stock records" %}</th>
                                                    <th>&nbsp;</th>
                                                </tr>
                                                {% for child in children %}
                                                    <tr>
                                                        <td>{{ child.get_title }}</td>
                                                        <td>{{ child.attribute_summary }}</td>
                                                        <td>{{ child.stockrecords.count }}</td>
                                                        <td>
                                                            <a href="{% url 'dashboard:catalogue-product' pk=child.id %}" class="btn btn-primary">
                                                                {% trans "Edit" %}
                                                            </a>
                                                            <a href="{% url 'dashboard:catalogue-product-delete' pk=child.id %}" class="btn btn-danger">
                                                                {% trans "Delete" %}
                                                            </a>
                                                        </td>
                                                    </tr>
                                                {% endfor %}
                                            {% else %}
                                                <tr>
                                                    <td colspan="3">
                                                        {% if product.can_be_parent %}
                                                            {% trans 'This product does not have any variants.' %}
                                                        {% else %}
                                                            {% trans "One can't add variants to this product at this point." %}
                                                            {% if product.has_stockrecords %}
                                                                {% trans 'This is likely because this product still has stock records.' %}
                                                            {% endif %}
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                            {% endif %}
                                        </table>
                                    {% endblock child_products_content %}
                                </div>
                            {% endwith %}
                        {% endblock child_products %}

                        {% block recommended_products %}
                            <div class="tab-pane" id="product_recommended">
                                {% block recommended_products_content %}
                                    <table class="table table-striped table-bordered form-inline">
                                        <caption>{% trans "Recommended products" %}</caption>
                                        {{ recommended_formset.management_form }}
                                        {{ recommended_formset.non_form_errors }}
                                        {% for recommended_form in recommended_formset %}
                                            <tr>
                                                <td>
                                                    {% include "dashboard/partials/form_fields_inline.html" with form=recommended_form %}
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </table>
                                {% endblock recommended_products_content %}
                            </div>
                        {% endblock recommended_products %}
                    {% endblock tab_content %}
                </div>
            </div>
        </div>

        {% block fixed_actions_group %}
            <div class="fixed-actions-group">
                <div class="form-group">
                    <div class="pull-right">
                        <a href="{% url 'dashboard:catalogue-product-list' %}">
                            {% trans "Cancel" %}
                        </a>
                        {% trans "or" %}
                        {% if parent %}
                            <button class="btn btn-default btn-lg" name="action" type="submit" value="create-another-child">
                                {% trans "Save and add another variant" %}
                            </button>
                        {% endif %}
                        <button class="btn btn-default btn-lg" name="action" type="submit" value="continue" >
                            {% trans "Save and continue editing" %}
                        </button>
                        <button class="btn btn-primary btn-lg" name="action" type="submit" value="save">
                            {% trans "Save" %}
                        </button>
                    </div>
                    <!--{% if product %}-->
                        <!--<a class="btn btn-success btn-lg" href="{{ product.get_absolute_url }}">{% trans "View on site" %}</a>-->
                    <!--{% endif %}-->
                </div>
            </div>
        {% endblock fixed_actions_group %}
    </form>
{% endblock dashboard_content %}

{% block extrascripts %}
    {{ block.super }}
    <script type='text/javascript' src="{% static 'oscar/js/dashboard/catalogue/product_image.js' %}"></script>
    <script type='text/javascript' src="{% static 'oscar/js/dashboard/catalogue/product_costing.js' %}"></script>
<link rel="stylesheet" href="{% static 'oscar/css/products/common_select2.css' %}" type="text/css" media="screen">

    <style>
        #mceu_20-body{
            display:none;
        }
    </style>



<script>


    $("#id_is_deposite_applicable").change(function(){
        if($('#id_is_deposite_applicable').is(':checked')){
            $("#dip_amount").css("display", "block");
        }
        else{
              $("#dip_amount").css("display", "none");
        }
    });

    $(document).ready(function() {
        if($('#id_is_deposite_applicable').is(':checked')){
            $("#dip_amount").css("display", "block");
        }
        else{
            $("#dip_amount").css("display", "none");
        }
         var single_type =  $('#id_product_cost_type').val();


        if($("#id_product_cost_type").val()=='Single')
        {
        $(".snt-art").css('display','block');
        $(".snt-real").css('display','block');
        }
        else if($("#id_product_cost_type").val()=='Multiple')
        {
        $(".snt-art").css('display','none');
        $(".snt-real").css('display','none');
        }

        var single_type =  $('#id_product_cost_type').val();

        if(($("#id_product_cost_type").val()=='Single') && (($('#id_is_artificial_flower').is(':checked')) || ($('#id_is_real_flower').is(':checked'))))
    {
        if($('#id_is_real_flower').is(':checked'))
        {
            $(".art_panel").css('display','block');
        }
        else
        {
        $(".art_panel").css('display','none');
        }

        if($('#id_is_artificial_flower').is(':checked'))
        {
        $(".real_panel").css('display','block');
        $(".real-rent-panel-pricing").html("Rent Pricing (Artificial Flower)");
        $(".real-rent-auto-pricing").html("Rent Pricing (Auto Calculated) (Artificial Flower) ");
        $(".real-sale-panel-pricing").html("Sale Pricing (Artificial Flower)");
        $(".real-sale-auto-pricing").html("Sale Pricing (Auto Calculated) (Artificial Flower) ");
        }
        else
        {
        $(".real_panel").css('display','none');
        }
    }
    else
    {
        $(".art_panel").css('display','none');
        $(".real_panel").css('display','block');
        $(".real-rent-panel-pricing").html("Rent Pricing");
        $(".real-rent-auto-pricing").html("Rent Pricing (Auto Calculated)");
        $(".real-sale-panel-pricing").html("Sale Pricing");
        $(".real-sale-auto-pricing").html("Sale Pricing (Auto Calculated) ");
    }

    if($('#id_is_transporation_available').is(':checked') && (single_type == 'Single'))
    {
        $(".shipping-price").css("display", "block");
    }
    else
    {
        $(".shipping-price").css("display", "none");
    }
    });

</script>

{% if product_class.name == 'Rent' %}
<script>
    $("#id_stockrecords-0-tax_percentage").change(function(){
        tax_val = $("#id_stockrecords-0-tax_percentage").val();

        if(tax_val==6)
        {
            $("#id_product_tax_type").val("composition_tax").change();
            $('#id_product_tax_type option[value="composition_tax"]').prop('selected', true);
        }
        else if(tax_val == 18)
        {
             $("#id_product_tax_type").val("regular_tax").change();
             $('#id_product_tax_type option[value="regular_tax"]').prop('selected', true);
        }
        else
        {
        alert("Please enter valid tax percentage");
        $("#id_stockrecords-0-tax_percentage").val('');
        $("#id_product_tax_type").val("").change();

        }
    });

$("#id_product_tax_type").change(function(){

        if($("#id_product_tax_type").val()=='composition_tax')
        {
        $("#id_stockrecords-0-tax_percentage").val(6);
        }
        else if($("#id_product_tax_type").val()=='regular_tax')
        {
        $("#id_stockrecords-0-tax_percentage").val(18);
        }
        else
        {
        $("#id_stockrecords-0-tax_percentage").val('');
        }

    });
</script>
{% elif product_class.name == 'Sale' %}
<script>
    $("#id_stockrecords-0-tax_percentage").change(function(){
        tax_val = $("#id_stockrecords-0-tax_percentage").val();

        if(tax_val==1 || tax_val == 1.00)
        {
            $("#id_product_tax_type").val("composition_tax").change();
            $('#id_product_tax_type option[value="composition_tax"]').prop('selected', true);
        }
        else if(tax_val == 18 || tax_val == 18.00)
        {
             $("#id_product_tax_type").val("regular_tax").change();
             $('#id_product_tax_type option[value="regular_tax"]').prop('selected', true);
        }
        else
        {
        alert("Please enter valid tax percentage");
        $("#id_stockrecords-0-tax_percentage").val('');
        $("#id_product_tax_type").val("").change();

        }
    });

$("#id_product_tax_type").change(function(){

        if($("#id_product_tax_type").val()=='composition_tax')
        {
        $("#id_stockrecords-0-tax_percentage").val(1.00);
        }
        else if($("#id_product_tax_type").val()=='regular_tax')
        {
        $("#id_stockrecords-0-tax_percentage").val(18.00);
        }
        else
        {
        $("#id_stockrecords-0-tax_percentage").val('');
        }

    });
</script>
{% else%}
<script>

    $("#id_stockrecords-0-tax_percentage").change(function(){
        tax_val = $("#id_stockrecords-0-tax_percentage").val();
        console.log(typeof tax_val);
        console.log(tax_val);

        if((tax_val==6) ||(tax_val ==6.00))
        {
            console.log("in if");
            $("#id_product_tax_type").val("composition_tax").change();
            $('#id_product_tax_type option[value="composition_tax"]').prop('selected', true);
            $("#id_stockrecords-0-sale_tax_percentage").val(1);
        }
        else if((tax_val == 18) ||(tax_val == 18.00))
        {
             console.log("in else");
             $("#id_product_tax_type").val("regular_tax").change();
             $('#id_product_tax_type option[value="regular_tax"]').prop('selected', true);
             $("#id_stockrecords-0-sale_tax_percentage").val(18);
        }
        else
        {
        alert("Please enter valid tax percentage");
        $("#id_stockrecords-0-tax_percentage").val('');
        $("#id_stockrecords-0-sale_tax_percentage").val('');
        $("#id_product_tax_type").val("").change();


        }
    });
    $("#id_stockrecords-0-sale_tax_percentage").change(function(){
        tax_val = $("#id_stockrecords-0-sale_tax_percentage").val();
        console.log(typeof tax_val);
        console.log(tax_val);

        if((tax_val==1) ||(tax_val ==1.00))
        {
            console.log("in if");
            $("#id_product_tax_type").val("composition_tax").change();
            $('#id_product_tax_type option[value="composition_tax"]').prop('selected', true);
            $("#id_stockrecords-0-tax_percentage").val(6);
        }
        else if((tax_val == 18) ||(tax_val == 18.00))
        {
             console.log("in else");
             $("#id_product_tax_type").val("regular_tax").change();
             $('#id_product_tax_type option[value="regular_tax"]').prop('selected', true);
             $("#id_stockrecords-0-tax_percentage").val(18);
        }
        else
        {
        alert("Please enter valid tax percentage");
        $("#id_stockrecords-0-tax_percentage").val('');
        $("#id_stockrecords-0-sale_tax_percentage").val('');
        $("#id_product_tax_type").val("").change();


        }
    });



</script>
{% endif %}

{% if product_class.name == 'Rent' or product_class.name == 'Professional' %}
<script>

    $(function(){
        $(".for_tax").on('change', function(){

            if($('#id_is_artificial_flower').is(':checked') || $('#id_is_real_flower').is(':checked')){

            if($('#id_is_real_flower').is(':checked')){
            art_excl_rent_price = parseFloat($("#id_stockrecords-0-art_rent_price").val());
            tax_perc = parseFloat($("#id_stockrecords-0-tax_percentage").val());
            art_round_off = parseFloat($("#id_stockrecords-0-art_rent_round_off_price").val());
            art_rent_market_price = parseFloat($("#id_stockrecords-0-art_rent_market_price").val());

            if(art_excl_rent_price && tax_perc)
            {
                art_price_with_tax = (art_excl_rent_price * (tax_perc / 100)) + art_excl_rent_price
                $("#id_stockrecords-0-art_rent_price_with_tax").val(art_price_with_tax.toFixed(2));

                if(art_rent_market_price)
                {
                art_rent_saving = art_rent_market_price - art_price_with_tax
                $("#id_stockrecords-0-art_rent_total_saving").val(art_rent_saving.toFixed(2));
                }
                else{
                alert("Please enter market price for real flower");
                $("#id_stockrecords-0-art_rent_total_saving").val('');
                }
                art_ceil_price = Math.ceil(art_price_with_tax)
                art_diff = art_ceil_price - art_price_with_tax

                if (art_diff <= 0.50)
                {
                $("#id_stockrecords-0-art_rent_round_off_price").val(art_diff.toFixed(2));
                art_round_off = parseFloat($("#id_stockrecords-0-art_rent_round_off_price").val());
                }
                else
                {
                $("#id_stockrecords-0-art_rent_round_off_price").val((art_diff-1).toFixed(2));
                art_round_off = parseFloat($("#id_stockrecords-0-art_rent_round_off_price").val());
                }
            }
            else
            {
                if(!art_excl_rent_price)
                {
                    alert("Please enter rent price excluding tax amount for real flower");
                }
                else
                {
                     alert("Please enter tax percentage");
                }
            }
            }
            if($('#id_is_artificial_flower').is(':checked')){
                excl_rent_price = parseFloat($("#id_stockrecords-0-rent_price").val());
            tax_perc = parseFloat($("#id_stockrecords-0-tax_percentage").val());
            round_off = parseFloat($("#id_stockrecords-0-rent_round_off_price").val());
            rent_market_price = parseFloat($("#id_stockrecords-0-rent_market_price").val());

            if(excl_rent_price && tax_perc)
            {
                price_with_tax = (excl_rent_price * (tax_perc / 100)) + excl_rent_price
                $("#id_stockrecords-0-rent_price_with_tax").val(price_with_tax.toFixed(2));

                if(rent_market_price)
                {
                rent_saving = rent_market_price - price_with_tax
                $("#id_stockrecords-0-rent_total_saving").val(rent_saving.toFixed(2));
                }
                else
                {
                alert("Please enter Market Price for artificial flower");
                $("#id_stockrecords-0-rent_total_saving").val('');
                }
                ceil_price = Math.ceil(price_with_tax)
                diff = ceil_price - price_with_tax

                if (diff <= 0.50)
                {
                $("#id_stockrecords-0-rent_round_off_price").val(diff.toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-rent_round_off_price").val());
                }
                else
                {
                $("#id_stockrecords-0-rent_round_off_price").val((diff-1).toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-rent_round_off_price").val());
                }
            }
            else
            {
                if(!excl_rent_price)
                {
                    alert("Please enter rent price excluding tax amount for artificial flower");
                }
                else
                {
                        alert("Please enter tax percentage");
                }
            }
            }
            }
            else{
            excl_rent_price = parseFloat($("#id_stockrecords-0-rent_price").val());
            tax_perc = parseFloat($("#id_stockrecords-0-tax_percentage").val());
            round_off = parseFloat($("#id_stockrecords-0-rent_round_off_price").val());
            rent_market_price = parseFloat($("#id_stockrecords-0-rent_market_price").val());

            if(excl_rent_price && tax_perc)
            {
                price_with_tax = (excl_rent_price * (tax_perc / 100)) + excl_rent_price
                $("#id_stockrecords-0-rent_price_with_tax").val(price_with_tax.toFixed(2));

                if(rent_market_price)
                {
                rent_saving = rent_market_price - price_with_tax
                $("#id_stockrecords-0-rent_total_saving").val(rent_saving.toFixed(2));
                }
                else
                {
                alert("Please enter Market Price");
                $("#id_stockrecords-0-rent_total_saving").val('');
                }
                ceil_price = Math.ceil(price_with_tax)
                diff = ceil_price - price_with_tax

                if (diff <= 0.50)
                {
                $("#id_stockrecords-0-rent_round_off_price").val(diff.toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-rent_round_off_price").val());
                }
                else
                {
                $("#id_stockrecords-0-rent_round_off_price").val((diff-1).toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-rent_round_off_price").val());
                }
            }
            else
            {
                if(!excl_rent_price)
                {
                    alert("Please enter rent price excluding tax amount");
                }
                else
                {
                        alert("Please enter tax percentage");
                }
            }
            }

    })

});

 $(function(){
        $(".market_price").on('change', function(){
         rent_market_price = parseFloat($("#id_stockrecords-0-rent_market_price").val());
         price_with_tax = $("#id_stockrecords-0-rent_price_with_tax").val();
          if(rent_market_price && price_with_tax)
          {
            rent_saving = rent_market_price - price_with_tax
            $("#id_stockrecords-0-rent_total_saving").val(rent_saving.toFixed(2));
          }
          else
          {
            $("#id_stockrecords-0-rent_total_saving").val('');
          }


          if($('#id_is_real_flower').is(':checked')){
          art_rent_market_price = parseFloat($("#id_stockrecords-0-art_rent_market_price").val());
          art_price_with_tax = $("#id_stockrecords-0-art_rent_price_with_tax").val();
          if(art_rent_market_price && art_price_with_tax)
          {
            art_rent_saving = art_rent_market_price - art_price_with_tax
            $("#id_stockrecords-0-art_rent_total_saving").val(art_rent_saving.toFixed(2));
          }
          else
          {
            $("#id_stockrecords-0-art_rent_total_saving").val('');
          }

          }
        })
        });

$("#id_product_tax_type").change(function(){

        if($("#id_product_tax_type").val()=='composition_tax')
        {
        $("#id_stockrecords-0-tax_percentage").val(6);
        }
        else if($("#id_product_tax_type").val()=='regular_tax')
        {
        $("#id_stockrecords-0-tax_percentage").val(18);
        }
        else
        {
        $("#id_stockrecords-0-tax_percentage").val('');
        }

            if($('#id_is_artificial_flower').is(':checked') || $('#id_is_real_flower').is(':checked')){

            if($('#id_is_real_flower').is(':checked')){
            art_excl_rent_price = parseFloat($("#id_stockrecords-0-art_rent_price").val());
            tax_perc = parseFloat($("#id_stockrecords-0-tax_percentage").val());
            art_round_off = parseFloat($("#id_stockrecords-0-art_rent_round_off_price").val());
            art_rent_market_price = parseFloat($("#id_stockrecords-0-art_rent_market_price").val());

            if(art_excl_rent_price && tax_perc)
            {
                art_price_with_tax = (art_excl_rent_price * (tax_perc / 100)) + art_excl_rent_price
                $("#id_stockrecords-0-art_rent_price_with_tax").val(art_price_with_tax.toFixed(2));

                if(art_rent_market_price)
                {
                art_rent_saving = art_rent_market_price - art_price_with_tax
                $("#id_stockrecords-0-art_rent_total_saving").val(art_rent_saving.toFixed(2));
                }
                else{
                alert("Please enter market price for real flower");
                $("#id_stockrecords-0-art_rent_total_saving").val('');
                }
                art_ceil_price = Math.ceil(art_price_with_tax)
                art_diff = art_ceil_price - art_price_with_tax

                if (art_diff <= 0.50)
                {
                $("#id_stockrecords-0-art_rent_round_off_price").val(art_diff.toFixed(2));
                art_round_off = parseFloat($("#id_stockrecords-0-art_rent_round_off_price").val());
                }
                else
                {
                $("#id_stockrecords-0-art_rent_round_off_price").val((art_diff-1).toFixed(2));
                art_round_off = parseFloat($("#id_stockrecords-0-art_rent_round_off_price").val());
                }
            }
            else
            {
                if(!art_excl_rent_price)
                {
                    alert("Please enter rent price excluding tax amount for real flower");
                }
                else
                {
                     alert("Please enter tax percentage");
                }
            }
            }
            if($('#id_is_artificial_flower').is(':checked')){
                excl_rent_price = parseFloat($("#id_stockrecords-0-rent_price").val());
            tax_perc = parseFloat($("#id_stockrecords-0-tax_percentage").val());
            round_off = parseFloat($("#id_stockrecords-0-rent_round_off_price").val());
            rent_market_price = parseFloat($("#id_stockrecords-0-rent_market_price").val());

            if(excl_rent_price && tax_perc)
            {
                price_with_tax = (excl_rent_price * (tax_perc / 100)) + excl_rent_price
                $("#id_stockrecords-0-rent_price_with_tax").val(price_with_tax.toFixed(2));

                if(rent_market_price)
                {
                rent_saving = rent_market_price - price_with_tax
                $("#id_stockrecords-0-rent_total_saving").val(rent_saving.toFixed(2));
                }
                else
                {
                alert("Please enter Market Price for artificial flower");
                $("#id_stockrecords-0-rent_total_saving").val('');
                }
                ceil_price = Math.ceil(price_with_tax)
                diff = ceil_price - price_with_tax

                if (diff <= 0.50)
                {
                $("#id_stockrecords-0-rent_round_off_price").val(diff.toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-rent_round_off_price").val());
                }
                else
                {
                $("#id_stockrecords-0-rent_round_off_price").val((diff-1).toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-rent_round_off_price").val());
                }
            }
            else
            {
                if(!excl_rent_price)
                {
                    alert("Please enter rent price excluding tax amount for artificial flower");
                }
                else
                {
                        alert("Please enter tax percentage");
                }
            }
            }
            }
            else{
            excl_rent_price = parseFloat($("#id_stockrecords-0-rent_price").val());
            tax_perc = parseFloat($("#id_stockrecords-0-tax_percentage").val());
            round_off = parseFloat($("#id_stockrecords-0-rent_round_off_price").val());
            rent_market_price = parseFloat($("#id_stockrecords-0-rent_market_price").val());

            if(excl_rent_price && tax_perc)
            {
                price_with_tax = (excl_rent_price * (tax_perc / 100)) + excl_rent_price
                $("#id_stockrecords-0-rent_price_with_tax").val(price_with_tax.toFixed(2));

                if(rent_market_price)
                {
                rent_saving = rent_market_price - price_with_tax
                $("#id_stockrecords-0-rent_total_saving").val(rent_saving.toFixed(2));
                }
                else
                {
                alert("Please enter Market Price");
                $("#id_stockrecords-0-rent_total_saving").val('');
                }
                ceil_price = Math.ceil(price_with_tax)
                diff = ceil_price - price_with_tax

                if (diff <= 0.50)
                {
                $("#id_stockrecords-0-rent_round_off_price").val(diff.toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-rent_round_off_price").val());
                }
                else
                {
                $("#id_stockrecords-0-rent_round_off_price").val((diff-1).toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-rent_round_off_price").val());
                }
            }
            else
            {
                if(!excl_rent_price)
                {
                    alert("Please enter rent price excluding tax amount");
                }
                else
                {
                        alert("Please enter tax percentage");
                }
            }
            }
    });


</script>

{% endif %}

{% if product_class.name == 'Sale' %}
<script>
$(function(){
       $(".for_tax").on('change', function(){

        if($('#id_is_artificial_flower').is(':checked') || $('#id_is_real_flower').is(':checked')){

        if($('#id_is_real_flower').is(':checked')){
            console.log("in art");

            art_excl_sale_price = parseFloat($("#id_stockrecords-0-art_sale_price").val());
            tax_perc = parseFloat($("#id_stockrecords-0-tax_percentage").val());
            art_round_off = parseFloat($("#id_stockrecords-0-art_sale_round_off_price").val());
            art_sale_market_price = parseFloat($("#id_stockrecords-0-art_sale_market_price").val());

            if(art_excl_sale_price && tax_perc)
            {
                art_price_with_tax = (art_excl_sale_price * (tax_perc / 100)) + art_excl_sale_price
                $("#id_stockrecords-0-art_sale_price_with_tax").val(art_price_with_tax.toFixed(2));
                if(art_sale_market_price)
                {
                    art_sale_saving = art_sale_market_price - art_price_with_tax
                    $("#id_stockrecords-0-art_sale_total_saving").val(art_sale_saving.toFixed(2));
                }
                else
                {
                    alert("Please enter Market Price for real flower");
                    $("#id_stockrecords-0-art_sale_total_saving").val('');
                }
                art_ceil_price = Math.ceil(art_price_with_tax)
                art_diff = art_ceil_price - art_price_with_tax
                console.log(art_diff);
                if (art_diff <= 0.50)
                {
                    $("#id_stockrecords-0-art_sale_round_off_price").val(art_diff.toFixed(2));
                    art_round_off = parseFloat($("#id_stockrecords-0-art_sale_round_off_price").val());
                }
                else
                {
                     $("#id_stockrecords-0-art_sale_round_off_price").val((art_diff-1).toFixed(2));
                     art_round_off = parseFloat($("#id_stockrecords-0-art_sale_round_off_price").val());
                }
            }
            else
            {
                if(!art_excl_sale_price)
                {
                    alert("Please enter sale price excluding tax amount for real flower");
                }
                else
                {
                     alert("Please enter tax percentage");
                }
            }

            }
            if($('#id_is_artificial_flower').is(':checked')){

            excl_sale_price = parseFloat($("#id_stockrecords-0-price_excl_tax").val());
            tax_perc = parseFloat($("#id_stockrecords-0-tax_percentage").val());
            round_off = parseFloat($("#id_stockrecords-0-sale_round_off_price").val());
            sale_market_price = parseFloat($("#id_stockrecords-0-sale_market_price").val());

            if(excl_sale_price && tax_perc)
            {
                price_with_tax = (excl_sale_price * (tax_perc / 100)) + excl_sale_price
                $("#id_stockrecords-0-sale_price_with_tax").val(price_with_tax.toFixed(2));
                if(sale_market_price)
                {
                    sale_saving = sale_market_price - price_with_tax
                    $("#id_stockrecords-0-sale_total_saving").val(sale_saving.toFixed(2));
                }
                else
                {
                    alert("Please enter Market Price for artificial flower");
                    $("#id_stockrecords-0-sale_total_saving").val('');
                }
                ceil_price = Math.ceil(price_with_tax)
                diff = ceil_price - price_with_tax

                if (diff <= 0.50)
                {
                    $("#id_stockrecords-0-sale_round_off_price").val(diff.toFixed(2));
                    round_off = parseFloat($("#id_stockrecords-0-sale_round_off_price").val());
                }
                else
                {
                $("#id_stockrecords-0-sale_round_off_price").val((diff-1).toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-sale_round_off_price").val());
                }
            }
            else
            {
                if(!excl_sale_price)
                {
                    alert("Please enter sale price excluding tax amount for artificial flower");
                }
                else
                {
                     alert("Please enter tax percentage");
                }
            }


            }

        }
        else{

            excl_sale_price = parseFloat($("#id_stockrecords-0-price_excl_tax").val());
            tax_perc = parseFloat($("#id_stockrecords-0-tax_percentage").val());
            round_off = parseFloat($("#id_stockrecords-0-sale_round_off_price").val());
            sale_market_price = parseFloat($("#id_stockrecords-0-sale_market_price").val());

            if(excl_sale_price && tax_perc)
            {
                price_with_tax = (excl_sale_price * (tax_perc / 100)) + excl_sale_price
                $("#id_stockrecords-0-sale_price_with_tax").val(price_with_tax.toFixed(2));
                if(sale_market_price)
                {
                    sale_saving = sale_market_price - price_with_tax
                    $("#id_stockrecords-0-sale_total_saving").val(sale_saving.toFixed(2));
                }
                else
                {
                    alert("Please enter Market Price");
                    $("#id_stockrecords-0-sale_total_saving").val('');
                }
                ceil_price = Math.ceil(price_with_tax)
                diff = ceil_price - price_with_tax

                if (diff <= 0.50)
                {
                    $("#id_stockrecords-0-sale_round_off_price").val(diff.toFixed(2));
                    round_off = parseFloat($("#id_stockrecords-0-sale_round_off_price").val());
                }
                else
                {
                $("#id_stockrecords-0-sale_round_off_price").val((diff-1).toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-sale_round_off_price").val());
                }
            }
            else
            {
                if(!excl_sale_price)
                {
                    alert("Please enter sale price excluding tax amount");
                }
                else
                {
                     alert("Please enter tax percentage");
                }
            }


            }
        })
});
$(function(){
        $(".market_price").on('change', function(){
         sale_market_price = parseFloat($("#id_stockrecords-0-sale_market_price").val());
         price_with_tax = $("#id_stockrecords-0-sale_price_with_tax").val();
          if(sale_market_price && price_with_tax)
          {
            sale_saving = sale_market_price - price_with_tax
            $("#id_stockrecords-0-sale_total_saving").val(sale_saving.toFixed(2));
          }
          else
          {
            $("#id_stockrecords-0-sale_total_saving").val('');
          }

          if($('#id_is_real_flower').is(':checked')){
          art_sale_market_price = parseFloat($("#id_stockrecords-0-art_sale_market_price").val());
          art_price_with_tax = $("#id_stockrecords-0-art_sale_price_with_tax").val();
          if(art_sale_market_price && art_price_with_tax)
          {
            art_sale_saving = art_sale_market_price - art_price_with_tax
            $("#id_stockrecords-0-art_sale_total_saving").val(art_sale_saving.toFixed(2));
          }
          else
          {
            $("#id_stockrecords-0-art_sale_total_saving").val('');
          }
          }
        })
        });

$("#id_product_tax_type").change(function(){

        if($("#id_product_tax_type").val()=='composition_tax')
        {
        $("#id_stockrecords-0-tax_percentage").val(1.00);
        }
        else if($("#id_product_tax_type").val()=='regular_tax')
        {
        $("#id_stockrecords-0-tax_percentage").val(18.00);
        }
        else
        {
        $("#id_stockrecords-0-tax_percentage").val('');
        }

        if($('#id_is_artificial_flower').is(':checked') || $('#id_is_real_flower').is(':checked')){

        if($('#id_is_real_flower').is(':checked')){
            console.log("in art");

            art_excl_sale_price = parseFloat($("#id_stockrecords-0-art_sale_price").val());
            tax_perc = parseFloat($("#id_stockrecords-0-tax_percentage").val());
            art_round_off = parseFloat($("#id_stockrecords-0-art_sale_round_off_price").val());
            art_sale_market_price = parseFloat($("#id_stockrecords-0-art_sale_market_price").val());

            if(art_excl_sale_price && tax_perc)
            {
                art_price_with_tax = (art_excl_sale_price * (tax_perc / 100)) + art_excl_sale_price
                $("#id_stockrecords-0-art_sale_price_with_tax").val(art_price_with_tax.toFixed(2));
                if(art_sale_market_price)
                {
                    art_sale_saving = art_sale_market_price - art_price_with_tax
                    $("#id_stockrecords-0-art_sale_total_saving").val(art_sale_saving.toFixed(2));
                }
                else
                {
                    alert("Please enter Market Price for real flower");
                    $("#id_stockrecords-0-art_sale_total_saving").val('');
                }
                art_ceil_price = Math.ceil(art_price_with_tax)
                art_diff = art_ceil_price - art_price_with_tax

                if (art_diff <= 0.50)
                {
                    $("#id_stockrecords-0-art_sale_round_off_price").val(art_diff.toFixed(2));
                    art_round_off = parseFloat($("#id_stockrecords-0-art_sale_round_off_price").val());
                }
                else
                {
                     $("#id_stockrecords-0-art_sale_round_off_price").val((art_diff-1).toFixed(2));
                     art_round_off = parseFloat($("#id_stockrecords-0-art_sale_round_off_price").val());
                }
            }
            else
            {
                if(!art_excl_sale_price)
                {
                    alert("Please enter sale price excluding tax amount for real flower");
                }
                else
                {
                     alert("Please enter tax percentage");
                }
            }

            }
            if($('#id_is_artificial_flower').is(':checked')){

            excl_sale_price = parseFloat($("#id_stockrecords-0-price_excl_tax").val());
            tax_perc = parseFloat($("#id_stockrecords-0-tax_percentage").val());
            round_off = parseFloat($("#id_stockrecords-0-sale_round_off_price").val());
            sale_market_price = parseFloat($("#id_stockrecords-0-sale_market_price").val());

            if(excl_sale_price && tax_perc)
            {
                price_with_tax = (excl_sale_price * (tax_perc / 100)) + excl_sale_price
                $("#id_stockrecords-0-sale_price_with_tax").val(price_with_tax.toFixed(2));
                if(sale_market_price)
                {
                    sale_saving = sale_market_price - price_with_tax
                    $("#id_stockrecords-0-sale_total_saving").val(sale_saving.toFixed(2));
                }
                else
                {
                    alert("Please enter Market Price for artificial flower");
                    $("#id_stockrecords-0-sale_total_saving").val('');
                }
                ceil_price = Math.ceil(price_with_tax)
                diff = ceil_price - price_with_tax

                if (diff <= 0.50)
                {
                    $("#id_stockrecords-0-sale_round_off_price").val(diff.toFixed(2));
                    round_off = parseFloat($("#id_stockrecords-0-sale_round_off_price").val());
                }
                else
                {
                $("#id_stockrecords-0-sale_round_off_price").val((diff-1).toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-sale_round_off_price").val());
                }
            }
            else
            {
                if(!excl_sale_price)
                {
                    alert("Please enter sale price excluding tax amount for artificial flower");
                }
                else
                {
                     alert("Please enter tax percentage");
                }
            }


            }

        }
        else{

            excl_sale_price = parseFloat($("#id_stockrecords-0-price_excl_tax").val());
            tax_perc = parseFloat($("#id_stockrecords-0-tax_percentage").val());
            round_off = parseFloat($("#id_stockrecords-0-sale_round_off_price").val());
            sale_market_price = parseFloat($("#id_stockrecords-0-sale_market_price").val());

            if(excl_sale_price && tax_perc)
            {
                price_with_tax = (excl_sale_price * (tax_perc / 100)) + excl_sale_price
                $("#id_stockrecords-0-sale_price_with_tax").val(price_with_tax.toFixed(2));
                if(sale_market_price)
                {
                    sale_saving = sale_market_price - price_with_tax
                    $("#id_stockrecords-0-sale_total_saving").val(sale_saving.toFixed(2));
                }
                else
                {
                    alert("Please enter Market Price");
                    $("#id_stockrecords-0-sale_total_saving").val('');
                }
                ceil_price = Math.ceil(price_with_tax)
                diff = ceil_price - price_with_tax

                if (diff <= 0.50)
                {
                    $("#id_stockrecords-0-sale_round_off_price").val(diff.toFixed(2));
                    round_off = parseFloat($("#id_stockrecords-0-sale_round_off_price").val());
                }
                else
                {
                $("#id_stockrecords-0-sale_round_off_price").val((diff-1).toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-sale_round_off_price").val());
                }
            }
            else
            {
                if(!excl_sale_price)
                {
                    alert("Please enter sale price excluding tax amount");
                }
                else
                {
                     alert("Please enter tax percentage");
                }
            }


            }

    });

</script>
{% endif %}
{% if product_class.name == 'Rent Or Sale' %}
<script>
         $(function(){
        $(".for_tax").on('change', function(){

        if($('#id_is_artificial_flower').is(':checked') || $('#id_is_real_flower').is(':checked')){
               if($('#id_is_real_flower').is(':checked')){

            art_excl_rent_price = parseFloat($("#id_stockrecords-0-art_rent_price").val());
            tax_perc = parseFloat($("#id_stockrecords-0-tax_percentage").val());
            sale_tax_perc = parseFloat($("#id_stockrecords-0-sale_tax_percentage").val());
            art_excl_sale_price = parseFloat($("#id_stockrecords-0-art_sale_price").val());
            art_round_off1 = parseFloat($("#id_stockrecords-0-art_rent_round_off_price").val());
            art_round_off2 = parseFloat($("#id_stockrecords-0-art_sale_round_off_price").val());
            art_sale_market_price = parseFloat($("#id_stockrecords-0-art_sale_market_price").val());
            art_rent_market_price = parseFloat($("#id_stockrecords-0-art_rent_market_price").val());

            if(art_excl_rent_price && tax_perc)
            {
                art_price_with_tax = (art_excl_rent_price * (tax_perc / 100)) + art_excl_rent_price

                $("#id_stockrecords-0-art_rent_price_with_tax").val(art_price_with_tax.toFixed(2));
                if(art_rent_market_price)
                {
                art_rent_saving = art_rent_market_price - art_price_with_tax
                $("#id_stockrecords-0-art_rent_total_saving").val(art_rent_saving.toFixed(2));
                }
                else{
                alert("Please enter Rent Market Price for real flower");
                 $("#id_stockrecords-0-art_rent_total_saving").val('');
                }


                art_ceil_price = Math.ceil(art_price_with_tax)
                diff = art_ceil_price - art_price_with_tax
                if (diff <= 0.50)
                {
                $("#id_stockrecords-0-art_rent_round_off_price").val(diff.toFixed(2));
                art_round_off = parseFloat($("#id_stockrecords-0-art_rent_round_off_price").val());
                }
                else
                {
                $("#id_stockrecords-0-art_rent_round_off_price").val((diff-1).toFixed(2));
                art_round_off = parseFloat($("#id_stockrecords-0-art_rent_round_off_price").val());
                }

            }
            if(art_excl_sale_price && sale_tax_perc)
            {
                art_price_with_tax = (art_excl_sale_price * (sale_tax_perc / 100)) + art_excl_sale_price
                $("#id_stockrecords-0-art_sale_price_with_tax").val(art_price_with_tax.toFixed(2));
                if(art_sale_market_price)
                {
                art_sale_saving = art_sale_market_price - art_price_with_tax
                $("#id_stockrecords-0-art_sale_total_saving").val(art_sale_saving.toFixed(2));
                }
                else{
                alert("Please enter Sale Market Price for real product");
                 $("#id_stockrecords-0-art_sale_total_saving").val('');
                }

                art_ceil_price = Math.ceil(art_price_with_tax)
                diff = art_ceil_price - art_price_with_tax
                if (diff <= 0.50)
                {
                $("#id_stockrecords-0-art_sale_round_off_price").val(diff.toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-art_sale_round_off_price").val());
                }
                else
                {
                $("#id_stockrecords-0-art_sale_round_off_price").val((diff-1).toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-art_sale_round_off_price").val());
                }
            }
            if(!art_excl_rent_price && !tax_perc)
            {
                alert("Please enter rent price excluding tax and rent tax percentage for real product");
            }
            else if(!art_excl_rent_price && tax_perc)
            {
                alert("Please enter rent price excluding tax for real product ");
                        console.log("we are here5")

            }
            else if(art_excl_rent_price && !tax_perc)
            {
                alert("Please enter rent tax percentage");
            }

            if(!art_excl_sale_price && !sale_tax_perc)
            {
                alert("Please enter sale price excluding tax and sale tax percentage for real product");
            }
            else if(!art_excl_sale_price && sale_tax_perc)
            {
                alert("Please enter sale price excluding tax for real product ");
            }
            else if(art_excl_sale_price && !sale_tax_perc)
            {
                alert("Please enter sale tax percentage");
            }
}
if($('#id_is_artificial_flower').is(':checked')){
excl_rent_price = parseFloat($("#id_stockrecords-0-rent_price").val());
            tax_perc = parseFloat($("#id_stockrecords-0-tax_percentage").val());
            sale_tax_perc = parseFloat($("#id_stockrecords-0-sale_tax_percentage").val());
            excl_sale_price = parseFloat($("#id_stockrecords-0-price_excl_tax").val());
            round_off1 = parseFloat($("#id_stockrecords-0-rent_round_off_price").val());
            round_off2 = parseFloat($("#id_stockrecords-0-sale_round_off_price").val());
            sale_market_price = parseFloat($("#id_stockrecords-0-sale_market_price").val());
            rent_market_price = parseFloat($("#id_stockrecords-0-rent_market_price").val());

            if(excl_rent_price && tax_perc)
            {
                price_with_tax = (excl_rent_price * (tax_perc / 100)) + excl_rent_price

                $("#id_stockrecords-0-rent_price_with_tax").val(price_with_tax.toFixed(2));
                if(rent_market_price)
                {
                rent_saving = rent_market_price - price_with_tax
                $("#id_stockrecords-0-rent_total_saving").val(rent_saving.toFixed(2));
                }
                else{
                alert("Please enter Rent Market Price for artificial flower");
                $("#id_stockrecords-0-rent_total_saving").val('');
                }


                ceil_price = Math.ceil(price_with_tax)
                diff = ceil_price - price_with_tax
                if (diff <= 0.50)
                {
                $("#id_stockrecords-0-rent_round_off_price").val(diff.toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-rent_round_off_price").val());
                }
                else
                {
                $("#id_stockrecords-0-rent_round_off_price").val((diff-1).toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-rent_round_off_price").val());
                }

            }
            if(excl_sale_price && sale_tax_perc)
            {
                price_with_tax = (excl_sale_price * (sale_tax_perc / 100)) + excl_sale_price
                $("#id_stockrecords-0-sale_price_with_tax").val(price_with_tax.toFixed(2));
                if(sale_market_price)
                {
                sale_saving = sale_market_price - price_with_tax
                $("#id_stockrecords-0-sale_total_saving").val(sale_saving.toFixed(2));
                }
                else{
                alert("Please enter Sale Market Price for artificial flower");
                $("#id_stockrecords-0-sale_total_saving").val('');
                }

                ceil_price = Math.ceil(price_with_tax)
                diff = ceil_price - price_with_tax
                if (diff <= 0.50)
                {
                $("#id_stockrecords-0-sale_round_off_price").val(diff.toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-sale_round_off_price").val());
                }
                else
                {
                $("#id_stockrecords-0-sale_round_off_price").val((diff-1).toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-sale_round_off_price").val());
                }
            }
            if(!excl_rent_price && !tax_perc)
            {
                alert("Please enter rent price excluding tax and rent tax percentage");
            }
            else if(!excl_rent_price && tax_perc)
            {
                alert("Please enter rent price excluding tax for artificial flower ");
                        console.log("we are here5")

            }
            else if(excl_rent_price && !tax_perc)
            {
                alert("Please enter rent tax percentage");
            }

            if(!excl_sale_price && !sale_tax_perc)
            {
                alert("Please enter sale price excluding tax and sale tax percentage for artificial flower");
            }
            else if(!excl_sale_price && sale_tax_perc)
            {
                alert("Please enter sale price excluding tax for artificial flower");
            }
            else if(excl_sale_price && !sale_tax_perc)
            {
                alert("Please enter sale tax percentage");
            }

}
        }
        else{
            excl_rent_price = parseFloat($("#id_stockrecords-0-rent_price").val());
            tax_perc = parseFloat($("#id_stockrecords-0-tax_percentage").val());
            sale_tax_perc = parseFloat($("#id_stockrecords-0-sale_tax_percentage").val());
            excl_sale_price = parseFloat($("#id_stockrecords-0-price_excl_tax").val());
            round_off1 = parseFloat($("#id_stockrecords-0-rent_round_off_price").val());
            round_off2 = parseFloat($("#id_stockrecords-0-sale_round_off_price").val());
            sale_market_price = parseFloat($("#id_stockrecords-0-sale_market_price").val());
            rent_market_price = parseFloat($("#id_stockrecords-0-rent_market_price").val());

            if(excl_rent_price && tax_perc)
            {
                price_with_tax = (excl_rent_price * (tax_perc / 100)) + excl_rent_price

                $("#id_stockrecords-0-rent_price_with_tax").val(price_with_tax.toFixed(2));
                if(rent_market_price)
                {
                rent_saving = rent_market_price - price_with_tax
                $("#id_stockrecords-0-rent_total_saving").val(rent_saving.toFixed(2));
                }
                else{
                alert("Please enter Rent Market Price");
                 $("#id_stockrecords-0-rent_total_saving").val('');
                }


                ceil_price = Math.ceil(price_with_tax)
                diff = ceil_price - price_with_tax
                if (diff <= 0.50)
                {
                $("#id_stockrecords-0-rent_round_off_price").val(diff.toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-rent_round_off_price").val());
                }
                else
                {
                $("#id_stockrecords-0-rent_round_off_price").val((diff-1).toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-rent_round_off_price").val());
                }

            }
            if(excl_sale_price && sale_tax_perc)
            {
                price_with_tax = (excl_sale_price * (sale_tax_perc / 100)) + excl_sale_price
                $("#id_stockrecords-0-sale_price_with_tax").val(price_with_tax.toFixed(2));
                if(sale_market_price)
                {
                sale_saving = sale_market_price - price_with_tax
                $("#id_stockrecords-0-sale_total_saving").val(sale_saving.toFixed(2));
                }
                else{
                alert("Please enter Sale Market Price");
                $("#id_stockrecords-0-sale_total_saving").val('');
                }

                ceil_price = Math.ceil(price_with_tax)
                diff = ceil_price - price_with_tax
                if (diff <= 0.50)
                {
                $("#id_stockrecords-0-sale_round_off_price").val(diff.toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-sale_round_off_price").val());
                }
                else
                {
                $("#id_stockrecords-0-sale_round_off_price").val((diff-1).toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-sale_round_off_price").val());
                }
            }
            if(!excl_rent_price && !tax_perc)
            {
                alert("Please enter rent price excluding tax and rent tax percentage");
            }
            else if(!excl_rent_price && tax_perc)
            {
                alert("Please enter rent price excluding tax ");
                        console.log("we are here5")

            }
            else if(excl_rent_price && !tax_perc)
            {
                alert("Please enter rent tax percentage");
            }

            if(!excl_sale_price && !sale_tax_perc)
            {
                alert("Please enter sale price excluding tax and sale tax percentage");
            }
            else if(!excl_sale_price && sale_tax_perc)
            {
                alert("Please enter sale price excluding tax ");
            }
            else if(excl_sale_price && !sale_tax_perc)
            {
                alert("Please enter sale tax percentage");
            }

            }
        })
        })
        $(function(){
        $(".market_price").on('change', function(){
         sale_market_price = parseFloat($("#id_stockrecords-0-sale_market_price").val());
         sale_price_with_tax = $("#id_stockrecords-0-sale_price_with_tax").val();
          if(sale_market_price && sale_price_with_tax)
          {
            sale_saving = sale_market_price - sale_price_with_tax
            $("#id_stockrecords-0-sale_total_saving").val(sale_saving.toFixed(2));
          }
          else if(!sale_market_price && sale_price_with_tax)
          {
            alert("Please enter sale market price");
            $("#id_stockrecords-0-sale_total_saving").val('');
          }
          else if(sale_market_price && !sale_price_with_tax)
          {
            alert("Please enter sale price excluding tax");
            $("#id_stockrecords-0-sale_total_saving").val('');
          }
          else
          {
                      $("#id_stockrecords-0-sale_total_saving").val('');
          }
          rent_market_price = parseFloat($("#id_stockrecords-0-rent_market_price").val());
         rent_price_with_tax = $("#id_stockrecords-0-rent_price_with_tax").val();
          if(rent_market_price && rent_price_with_tax)
          {
            rent_saving = rent_market_price - rent_price_with_tax
            $("#id_stockrecords-0-rent_total_saving").val(rent_saving.toFixed(2));
          }
          else if(!rent_market_price && rent_price_with_tax)
          {
            alert("Please enter rent market price");
            $("#id_stockrecords-0-rent_total_saving").val('');

          }
          else if(rent_market_price && !rent_price_with_tax)
          {
            alert("Please enter rent price excluding tax");
            $("#id_stockrecords-0-rent_total_saving").val('');
          }
          else{
          $("#id_stockrecords-0-rent_total_saving").val('');
          }

          if($('#id_is_real_flower').is(':checked')){

          art_sale_market_price = parseFloat($("#id_stockrecords-0-art_sale_market_price").val());
          art_sale_price_with_tax = $("#id_stockrecords-0-art_sale_price_with_tax").val();
          if(art_sale_market_price && art_sale_price_with_tax)
          {
            art_sale_saving = art_sale_market_price - art_sale_price_with_tax
            $("#id_stockrecords-0-art_sale_total_saving").val(art_sale_saving.toFixed(2));
          }
          else if(!art_sale_market_price && art_sale_price_with_tax)
          {
            alert("Please enter sale market price for real flower");
             $("#id_stockrecords-0-art_sale_total_saving").val('');

          }
          else if(art_sale_market_price && !art_sale_price_with_tax)
          {
            alert("Please enter sale price excluding tax for real flower");
                         $("#id_stockrecords-0-art_sale_total_saving").val('');
          }
          else{
                       $("#id_stockrecords-0-art_sale_total_saving").val('');
           }
          art_rent_market_price = parseFloat($("#id_stockrecords-0-art_rent_market_price").val());
         art_rent_price_with_tax = $("#id_stockrecords-0-art_rent_price_with_tax").val();
          if(art_rent_market_price && art_rent_price_with_tax)
          {
            art_rent_saving = art_rent_market_price - art_rent_price_with_tax
            $("#id_stockrecords-0-art_rent_total_saving").val(art_rent_saving.toFixed(2));
          }
          else if(!art_rent_market_price && art_rent_price_with_tax)
          {
            alert("Please enter rent market price for real flower");
            $("#id_stockrecords-0-art_rent_total_saving").val('');
          }
          else if(art_rent_market_price && !art_rent_price_with_tax)
          {
            alert("Please enter rent price excluding tax for real flower");
            $("#id_stockrecords-0-art_rent_total_saving").val('');
          }
           else
           {
                       $("#id_stockrecords-0-art_rent_total_saving").val('');
            }
          }
        })
        });

$("#id_product_tax_type").change(function(){

        if($("#id_product_tax_type").val()=='composition_tax')
        {
        $("#id_stockrecords-0-tax_percentage").val(6);
        $("#id_stockrecords-0-sale_tax_percentage").val(1);
        }
        else if($("#id_product_tax_type").val()=='regular_tax')
        {
        $("#id_stockrecords-0-tax_percentage").val(18);
        $("#id_stockrecords-0-sale_tax_percentage").val(18);
        }
        else
        {
        $("#id_stockrecords-0-tax_percentage").val('');
        $("#id_stockrecords-0-sale_tax_percentage").val('');
        }

        if($('#id_is_artificial_flower').is(':checked') || $('#id_is_real_flower').is(':checked')){
               if($('#id_is_real_flower').is(':checked')){

            art_excl_rent_price = parseFloat($("#id_stockrecords-0-art_rent_price").val());
            tax_perc = parseFloat($("#id_stockrecords-0-tax_percentage").val());
            sale_tax_perc = parseFloat($("#id_stockrecords-0-sale_tax_percentage").val());
            art_excl_sale_price = parseFloat($("#id_stockrecords-0-art_sale_price").val());
            art_round_off1 = parseFloat($("#id_stockrecords-0-art_rent_round_off_price").val());
            art_round_off2 = parseFloat($("#id_stockrecords-0-art_sale_round_off_price").val());
            art_sale_market_price = parseFloat($("#id_stockrecords-0-art_sale_market_price").val());
            art_rent_market_price = parseFloat($("#id_stockrecords-0-art_rent_market_price").val());

            if(art_excl_rent_price && tax_perc)
            {
                art_price_with_tax = (art_excl_rent_price * (tax_perc / 100)) + art_excl_rent_price

                $("#id_stockrecords-0-art_rent_price_with_tax").val(art_price_with_tax.toFixed(2));
                if(art_rent_market_price)
                {
                art_rent_saving = art_rent_market_price - art_price_with_tax
                $("#id_stockrecords-0-art_rent_total_saving").val(art_rent_saving.toFixed(2));
                }
                else{
                alert("Please enter Rent Market Price for real flower");
                 $("#id_stockrecords-0-art_rent_total_saving").val('');
                }


                art_ceil_price = Math.ceil(art_price_with_tax)
                diff = art_ceil_price - art_price_with_tax
                if (diff <= 0.50)
                {
                $("#id_stockrecords-0-art_rent_round_off_price").val(diff.toFixed(2));
                art_round_off = parseFloat($("#id_stockrecords-0-art_rent_round_off_price").val());
                }
                else
                {
                $("#id_stockrecords-0-art_rent_round_off_price").val((diff-1).toFixed(2));
                art_round_off = parseFloat($("#id_stockrecords-0-art_rent_round_off_price").val());
                }

            }
            if(art_excl_sale_price && sale_tax_perc)
            {
                art_price_with_tax = (art_excl_sale_price * (sale_tax_perc / 100)) + art_excl_sale_price
                $("#id_stockrecords-0-art_sale_price_with_tax").val(art_price_with_tax.toFixed(2));
                if(art_sale_market_price)
                {
                art_sale_saving = art_sale_market_price - art_price_with_tax
                $("#id_stockrecords-0-art_sale_total_saving").val(art_sale_saving.toFixed(2));
                }
                else{
                alert("Please enter Sale Market Price for real product");
                $("#id_stockrecords-0-art_sale_total_saving").val('');
                }

                art_ceil_price = Math.ceil(art_price_with_tax)
                diff = art_ceil_price - art_price_with_tax
                if (diff <= 0.50)
                {
                $("#id_stockrecords-0-art_sale_round_off_price").val(diff.toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-art_sale_round_off_price").val());
                }
                else
                {
                $("#id_stockrecords-0-art_sale_round_off_price").val((diff-1).toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-art_sale_round_off_price").val());
                }
            }
            if(!art_excl_rent_price && !tax_perc)
            {
                alert("Please enter rent price excluding tax and rent tax percentage for real product");
            }
            else if(!art_excl_rent_price && tax_perc)
            {
                alert("Please enter rent price excluding tax for real product ");
                        console.log("we are here5")

            }
            else if(art_excl_rent_price && !tax_perc)
            {
                alert("Please enter rent tax percentage");
            }

            if(!art_excl_sale_price && !sale_tax_perc)
            {
                alert("Please enter sale price excluding tax and sale tax percentage for real product");
            }
            else if(!art_excl_sale_price && sale_tax_perc)
            {
                alert("Please enter sale price excluding tax for real product ");
            }
            else if(art_excl_sale_price && !sale_tax_perc)
            {
                alert("Please enter sale tax percentage");
            }
}
if($('#id_is_artificial_flower').is(':checked')){
excl_rent_price = parseFloat($("#id_stockrecords-0-rent_price").val());
            tax_perc = parseFloat($("#id_stockrecords-0-tax_percentage").val());
            sale_tax_perc = parseFloat($("#id_stockrecords-0-sale_tax_percentage").val());
            excl_sale_price = parseFloat($("#id_stockrecords-0-price_excl_tax").val());
            round_off1 = parseFloat($("#id_stockrecords-0-rent_round_off_price").val());
            round_off2 = parseFloat($("#id_stockrecords-0-sale_round_off_price").val());
            sale_market_price = parseFloat($("#id_stockrecords-0-sale_market_price").val());
            rent_market_price = parseFloat($("#id_stockrecords-0-rent_market_price").val());

            if(excl_rent_price && tax_perc)
            {
                price_with_tax = (excl_rent_price * (tax_perc / 100)) + excl_rent_price

                $("#id_stockrecords-0-rent_price_with_tax").val(price_with_tax.toFixed(2));
                if(rent_market_price)
                {
                rent_saving = rent_market_price - price_with_tax
                $("#id_stockrecords-0-rent_total_saving").val(rent_saving.toFixed(2));
                }
                else{
                alert("Please enter Rent Market Price for artificial flower");
                $("#id_stockrecords-0-rent_total_saving").val('');
                }


                ceil_price = Math.ceil(price_with_tax)
                diff = ceil_price - price_with_tax
                if (diff <= 0.50)
                {
                $("#id_stockrecords-0-rent_round_off_price").val(diff.toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-rent_round_off_price").val());
                }
                else
                {
                $("#id_stockrecords-0-rent_round_off_price").val((diff-1).toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-rent_round_off_price").val());
                }

            }
            if(excl_sale_price && sale_tax_perc)
            {
                price_with_tax = (excl_sale_price * (sale_tax_perc / 100)) + excl_sale_price
                $("#id_stockrecords-0-sale_price_with_tax").val(price_with_tax.toFixed(2));
                if(sale_market_price)
                {
                sale_saving = sale_market_price - price_with_tax
                $("#id_stockrecords-0-sale_total_saving").val(sale_saving.toFixed(2));
                }
                else{
                alert("Please enter Sale Market Price for artificial flower");
                $("#id_stockrecords-0-sale_total_saving").val('');
                }

                ceil_price = Math.ceil(price_with_tax)
                diff = ceil_price - price_with_tax
                if (diff <= 0.50)
                {
                $("#id_stockrecords-0-sale_round_off_price").val(diff.toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-sale_round_off_price").val());
                }
                else
                {
                $("#id_stockrecords-0-sale_round_off_price").val((diff-1).toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-sale_round_off_price").val());
                }
            }
            if(!excl_rent_price && !tax_perc)
            {
                alert("Please enter rent price excluding tax and rent tax percentage");
            }
            else if(!excl_rent_price && tax_perc)
            {
                alert("Please enter rent price excluding tax for artificial flower ");
                        console.log("we are here5")

            }
            else if(excl_rent_price && !tax_perc)
            {
                alert("Please enter rent tax percentage");
            }

            if(!excl_sale_price && !sale_tax_perc)
            {
                alert("Please enter sale price excluding tax and sale tax percentage for artificial flower");
            }
            else if(!excl_sale_price && sale_tax_perc)
            {
                alert("Please enter sale price excluding tax for artificial flower");
            }
            else if(excl_sale_price && !sale_tax_perc)
            {
                alert("Please enter sale tax percentage");
            }

}
        }
        else{
            excl_rent_price = parseFloat($("#id_stockrecords-0-rent_price").val());
            tax_perc = parseFloat($("#id_stockrecords-0-tax_percentage").val());
            sale_tax_perc = parseFloat($("#id_stockrecords-0-sale_tax_percentage").val());
            excl_sale_price = parseFloat($("#id_stockrecords-0-price_excl_tax").val());
            round_off1 = parseFloat($("#id_stockrecords-0-rent_round_off_price").val());
            round_off2 = parseFloat($("#id_stockrecords-0-sale_round_off_price").val());
            sale_market_price = parseFloat($("#id_stockrecords-0-sale_market_price").val());
            rent_market_price = parseFloat($("#id_stockrecords-0-rent_market_price").val());

            if(excl_rent_price && tax_perc)
            {
                price_with_tax = (excl_rent_price * (tax_perc / 100)) + excl_rent_price

                $("#id_stockrecords-0-rent_price_with_tax").val(price_with_tax.toFixed(2));
                if(rent_market_price)
                {
                rent_saving = rent_market_price - price_with_tax
                $("#id_stockrecords-0-rent_total_saving").val(rent_saving.toFixed(2));
                }
                else{
                alert("Please enter Rent Market Price");
                 $("#id_stockrecords-0-rent_total_saving").val('');
                }


                ceil_price = Math.ceil(price_with_tax)
                diff = ceil_price - price_with_tax
                if (diff <= 0.50)
                {
                $("#id_stockrecords-0-rent_round_off_price").val(diff.toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-rent_round_off_price").val());
                }
                else
                {
                $("#id_stockrecords-0-rent_round_off_price").val((diff-1).toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-rent_round_off_price").val());
                }

            }
            if(excl_sale_price && sale_tax_perc)
            {
                price_with_tax = (excl_sale_price * (sale_tax_perc / 100)) + excl_sale_price
                $("#id_stockrecords-0-sale_price_with_tax").val(price_with_tax.toFixed(2));
                if(sale_market_price)
                {
                sale_saving = sale_market_price - price_with_tax
                $("#id_stockrecords-0-sale_total_saving").val(sale_saving.toFixed(2));
                }
                else{
                alert("Please enter Sale Market Price");
                $("#id_stockrecords-0-sale_total_saving").val('');
                }

                ceil_price = Math.ceil(price_with_tax)
                diff = ceil_price - price_with_tax
                if (diff <= 0.50)
                {
                $("#id_stockrecords-0-sale_round_off_price").val(diff.toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-sale_round_off_price").val());
                }
                else
                {
                $("#id_stockrecords-0-sale_round_off_price").val((diff-1).toFixed(2));
                round_off = parseFloat($("#id_stockrecords-0-sale_round_off_price").val());
                }
            }
            if(!excl_rent_price && !tax_perc)
            {
                alert("Please enter rent price excluding tax and rent tax percentage");
            }
            else if(!excl_rent_price && tax_perc)
            {
                alert("Please enter rent price excluding tax ");
                        console.log("we are here5")

            }
            else if(excl_rent_price && !tax_perc)
            {
                alert("Please enter rent tax percentage");
            }

            if(!excl_sale_price && !sale_tax_perc)
            {
                alert("Please enter sale price excluding tax and sale tax percentage");
            }
            else if(!excl_sale_price && sale_tax_perc)
            {
                alert("Please enter sale price excluding tax ");
            }
            else if(excl_sale_price && !sale_tax_perc)
            {
                alert("Please enter sale tax percentage");
            }

            }
    });


</script>

{% endif %}
<script>
function add_attribute_formset(){
    $('.empty:last').nextAll().slice(0, 1).toggleClass('empty tr_clone');
}
function delete_attribute(counter){
    var attribute_id = 'id_attribute_mapping-'+counter+'-id'
    var db_id = $('#'+attribute_id).val();
    if (db_id == ''){
        alert('You can not preform this action.')
        return false;
    }
    var is_confirm = confirm("Do you really want to delete this attribute.");
    if (is_confirm == false){
        return false;
    }

    delete_attribute_ajax(db_id)

}

function delete_attribute_ajax(id){
    $.ajax({
        type:'GET',
        url : '/delete_product_attribute/',
        data : {
            attribute_id: id
        },
        success : function(data){
            if (data == '503'){
                window.location.replace("/dashboard/catalogue/");
            }
            if (data == '200'){
                window.location.reload();
            }
        },
        failure : function(result){

        },
    });
}

$("#id_product_cost_type").change(function(){

        if($("#id_product_cost_type").val()=='Single')
        {
        $(".snt-art").css('display','block');
        $(".snt-real").css('display','block');
        }
        else if($("#id_product_cost_type").val()=='Multiple')
        {
        $(".snt-art").css('display','none');
        $(".snt-real").css('display','none');
        $('#id_is_artificial_flower').prop('checked', false); // Unchecks it
        $('#id_is_real_flower').prop('checked', false); // Unchecks it
        }

    });

</script>

<script>
    $(document).ready(function() {
    $('#id_is_approved').select2();
    $('#id_product_cost_type').select2();
    $('#id_product_tax_type').select2();
    $('#id_productcategory_set-0-category').select2();
    $('#id_stockrecords-0-partner').select2();
    $('#id_stockrecords-0-unit').select2();
    $('.product-attr-val').select2();
    $('.product-attr').select2();
    var upc_value = $("#id_upc").val();
    if(upc_value){
    $("#id_stockrecords-0-partner_sku").val(upc_value);
    }

    if($('#id_is_package').is(':checked')){
            $("#product_package_tab").css("display", "block");
        }
        else{
              $("#product_package_tab").css("display", "none");
        }
    });
    $("#id_upc").change(function(){
        var upc_value = $("#id_upc").val();
        $("#id_stockrecords-0-partner_sku").val(upc_value);
    });
    $("#id_is_package").change(function(){
    if($('#id_is_package').is(':checked')){
            $("#product_package_tab").css("display", "block");
        }
        else{
              $("#product_package_tab").css("display", "none");
        }
    });

</script>


<style>
    .panel-title{
        font-weight:bold; font-size:14px;
    }
</style>

{% endblock %}